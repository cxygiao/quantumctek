'''
功能：分布式映射
作者：陈子禄
版本: 1.0
完成时间：2023.5.18
'''


from Utils.Distributed_mapping.dmap_main import *
from Utils.Distributed_mapping.dataFrame_to_list import *
from Utils.Distributed_mapping.read_color_qasm import *

Number_of_iterations = 1 # 迭代次数

'''测试用例'''
if __name__ == '__main__':

    '''
    coupling_graph_A ：A架构图字典
    coupling_graph_B : B架构图字典
    communication_Qubit : 两个图用于连接的点
    coupling_list : A和B架构的连通列表
    circuit : 量子线路列表
    initial_mapping ：初始映射列表
    num_qubits : 量子线路比特数
    '''

    coupling_graph_A = {1: [7, 8], 7: [1, 13], 8: [1, 2, 13, 14], 2: [8, 9], 9: [2, 3, 14, 15], 3: [9, 10],
                        10: [3, 4, 15, 16],
                        4: [10, 11], 11: [4, 5, 16, 17], 5: [11, 12], 12: [5, 6, 17, 18], 6: [12], 13: [7, 8, 19, 20],
                        14: [8, 9, 20, 21], 15: [9, 10, 21, 22], 16: [10, 11, 22, 23], 17: [11, 12, 23, 24],
                        18: [12, 24],
                        19: [13, 25], 20: [13, 14, 25, 26], 21: [14, 15, 26, 27], 22: [15, 16, 27, 28],
                        23: [16, 17, 28, 29],
                        24: [17, 18, 29, 30], 25: [19, 20, 31, 32], 26: [20, 21, 32, 33], 27: [21, 22, 33, 34],
                        28: [22, 23, 34, 35], 29: [23, 24, 35], 30: [24, 36], 31: [25, 37], 32: [25, 26, 37, 38],
                        33: [26, 27, 38, 39], 34: [27, 28, 39, 40], 35: [28, 29, 40, 41], 39: [33, 34, 45, 46],
                        36: [39, 30, 41, 42], 37: [31, 32, 43, 44], 38: [32, 33, 44, 45], 40: [34, 35, 46, 47],
                        41: [35, 36, 47, 48], 42: [36, 48], 43: [37, 49], 44: [37, 38, 49, 50], 45: [38, 39, 50, 51],
                        46: [39, 40, 51, 52], 47: [40, 41, 52, 53], 48: [41, 42, 53, 54], 49: [43, 44, 55, 56],
                        50: [44, 45, 56, 57], 51: [45, 46, 57, 58], 52: [46, 47, 58, 59], 53: [47, 48, 59, 60],
                        54: [48, 60],
                        55: [49, 61], 56: [49, 50, 61, 62], 57: [50, 51, 62, 63], 58: [51, 52, 63, 64],
                        59: [52, 53, 64, 65],
                        60: [53, 54, 65, 66], 61: [55, 56], 62: [56, 57], 63: [57, 58], 64: [58, 59], 65: [59, 60],
                        66: [60]}
    coupling_graph_B = {67: [73, 74], 73: [67, 79], 74: [67, 68, 79, 80], 68: [74, 75], 75: [68, 69, 80, 81],
                        69: [75, 76],
                        76: [69, 70, 81, 82], 70: [76, 77], 77: [70, 71, 82, 83], 71: [77, 78], 78: [71, 72, 83, 84],
                        72: [78],
                        79: [73, 74, 85, 86], 80: [74, 75, 86, 87], 81: [75, 76, 87, 88], 82: [76, 77, 88, 89],
                        83: [77, 78, 89, 90], 84: [78, 90], 85: [79, 91], 86: [79, 80, 91, 92], 87: [80, 81, 92, 93],
                        88: [81, 82, 93, 94], 89: [82, 83, 94, 95], 90: [83, 84, 95, 96], 91: [85, 86, 97, 98],
                        92: [86, 87, 98, 99], 93: [87, 88, 99, 100], 94: [88, 89, 100, 101], 95: [89, 90, 101],
                        96: [90, 102],
                        97: [91, 103], 98: [91, 92, 103, 104], 99: [92, 93, 104, 105], 100: [93, 94, 105, 106],
                        101: [94, 95, 106, 107], 105: [102, 99, 100, 111, 112], 102: [105, 96, 107, 108],
                        103: [97, 98, 109, 110],
                        104: [98, 99, 110, 111], 106: [100, 101, 112, 113], 107: [101, 102, 113, 114], 108: [102, 114],
                        109: [103, 115], 110: [103, 104, 115, 116], 111: [104, 105, 116, 117],
                        112: [105, 106, 117, 118],
                        113: [106, 107, 118, 119], 114: [107, 108, 119, 120], 115: [109, 110, 121, 122],
                        116: [110, 111, 122, 123], 117: [111, 112, 123, 124], 118: [112, 113, 124, 125],
                        119: [113, 114, 125, 126], 120: [114, 126], 121: [115, 127], 122: [115, 116, 127, 128],
                        123: [116, 117, 128, 129], 124: [117, 118, 129, 130], 125: [118, 119, 130, 131],
                        126: [119, 120, 131, 132], 127: [121, 122], 128: [122, 123], 129: [123, 124], 130: [124, 125],
                        131: [125, 126], 132: [126]}
    communication_Qubit = [6, 67]
    coupling_list = [[1, 7], [1, 8], [2, 8], [2, 9], [3, 9], [3, 10], [4, 10], [4, 11], [5, 11], [5, 12], [6, 12],
                     [7, 13],
                     [8, 13], [8, 14], [9, 14], [9, 15], [10, 15], [10, 16], [11, 16], [11, 17], [12, 17], [12, 18],
                     [13, 19], [13, 20], [14, 20], [14, 21], [15, 21], [15, 22], [16, 22], [16, 23], [17, 23], [17, 24],
                     [18, 24], [19, 25], [20, 25], [20, 26], [21, 26], [21, 27], [22, 27], [22, 28], [23, 28], [23, 29],
                     [24, 29], [24, 30], [25, 31], [25, 32], [26, 32], [26, 33], [27, 33], [27, 34], [28, 34], [28, 35],
                     [29, 35], [39, 36], [30, 36], [31, 37], [32, 37], [32, 38], [33, 38], [33, 39], [34, 39], [34, 40],
                     [35, 40], [35, 41], [36, 41], [36, 42], [37, 43], [37, 44], [38, 44], [38, 45], [39, 45], [39, 46],
                     [40, 46], [40, 47], [41, 47], [41, 48], [42, 48], [43, 49], [44, 49], [44, 50], [45, 50], [45, 51],
                     [46, 51], [46, 52], [47, 52], [47, 53], [48, 53], [48, 54], [49, 55], [49, 56], [50, 56], [50, 57],
                     [51, 57], [51, 58], [52, 58], [52, 59], [53, 59], [53, 60], [54, 60], [55, 61], [56, 61], [56, 62],
                     [67, 73],
                     [67, 74], [68, 74], [68, 75], [69, 75], [69, 76], [70, 76], [70, 77], [71, 77], [71, 78],
                     [72, 78], [73, 79], [74, 79], [74, 80], [75, 80], [75, 81], [76, 81], [76, 82], [77, 82], [77, 83],
                     [78, 83], [78, 84], [79, 85], [79, 86], [80, 86], [80, 87], [81, 87], [81, 88], [82, 88], [82, 89],
                     [83, 89], [83, 90], [84, 90], [85, 91], [86, 91], [86, 92], [87, 92], [87, 93], [88, 93], [88, 94],
                     [89, 94], [89, 95], [90, 95], [90, 96], [91, 97], [91, 98], [92, 98], [92, 99], [93, 99],
                     [93, 100],
                     [94, 100], [94, 101], [95, 101], [105, 102], [96, 102], [97, 103], [98, 103], [98, 104], [99, 104],
                     [99, 105], [100, 105], [100, 106], [101, 106], [101, 107], [102, 107], [102, 108], [103, 109],
                     [103, 110], [104, 110], [104, 111], [105, 111], [105, 112], [106, 112], [106, 113], [107, 113],
                     [107, 114], [108, 114], [109, 115], [110, 115], [110, 116], [111, 116], [111, 117], [112, 117],
                     [112, 118], [113, 118], [113, 119], [114, 119], [114, 120], [115, 121], [115, 122], [116, 122],
                     [116, 123], [117, 123], [117, 124], [118, 124], [118, 125], [119, 125], [119, 126], [120, 126],
                     [121, 127], [122, 127], [122, 128], [123, 128], [123, 129], [124, 129], [124, 130], [125, 130],
                     [125, 131], [126, 131], [126, 132]]

    input_filename = r'/qasm/color_qasm/3z4/3z4fj_czopt.qasm'
    qubit_num, gate_num, q_name_list, q_num_list = converter_num_from_qasm(input_filename)
    df_ori_qc = converter_dataframe_from_qasm(input_filename, qubit_num, gate_num, q_name_list, q_num_list)
    cir_list = dataframe_to_list(df_ori_qc)

    initial_mapping = [12, 5, 17, 18, 11, 23, 24, 4, 16, 28, 29, 30, 10, 22, 34, 35, 36, 3, 15, 27, 39, 40, 41, 42, 9,
                       21, 33, 45, 46, 47, 48, 2, 14, 26, 38, 50, 6, 67, 73, 74, 79, 68, 80, 85, 86, 75, 87, 91, 92, 69,
                       81, 93, 97, 98, 99, 76, 88, 100, 103, 104, 105, 70, 82, 94, 106, 109, 110, 111, 102, 112, 77, 89,
                       101, 113]
    num_qubits = 72
    circuit = change_circ(cir_list,num_qubits)

    datafra = run_circ(Number_of_iterations,circuit,num_qubits,communication_Qubit,coupling_list,coupling_graph_A,coupling_graph_B,initial_mapping)

    print(datafra)

